{% extends 'base.html' %}

{% block content %}
  <h1>Inscriptions approuvées par étudiant</h1>

  <table id="registrationTable" border="1">
    <thead>
      <tr>
        <th><input type="text" placeholder="Filtrer par étudiant"></th>
        <th><input type="text" placeholder="Filtrer par UE"></th>
        <th><input type="text" placeholder="Filtrer par note"></th>
        <th><input type="text" placeholder="Filtrer par statut"></th>
        <th><input type="text" placeholder="Filtrer par approbation"></th>
      </tr>
      <tr>
        <th>Étudiant</th>
        <th>Unité d'enseignement</th>
        <th>Note</th>
        <th>Statut</th>
        <th>Approuvé</th>
      </tr>
    </thead>
    <tbody>
      {% for reg in registrations %}
        <tr>
          <td>{{ reg.student.first_name }} {{ reg.student.last_name }}</td>
          <td>{{ reg.academic_ue.wording }}</td>
          <td>
            {% if reg.result is not None %}
              {{ reg.result }}
            {% else %}
              Non noté
            {% endif %}
          </td>
          <td>
            {% if reg.status == 'AP' %}
              Approuvé
            {% else %}
              Non Passé
            {% endif %}
          </td>
          <td>{{ reg.approved|yesno:"Oui,Non" }}</td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="5">Aucune inscription approuvée trouvée.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}

{% block scripts %}
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function() {
      // À chaque frappe dans un input du thead
      $('#registrationTable thead input').on('keyup', function() {
        let $inputs = $('#registrationTable thead input');

        $('#registrationTable tbody tr').each(function() {
          let show = true;

          $(this).find('td').each(function(index) {
            let filterText = $inputs.eq(index).val().toLowerCase();
            let cellText = $(this).text().toLowerCase();

            if (filterText && !cellText.includes(filterText)) {
              show = false;
              return false; // stop la boucle des td pour cette ligne
            }
          });

          $(this).toggle(show);
        });
      });
    });
  </script>
{% endblock %}
